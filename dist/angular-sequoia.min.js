!function(){"use strict";angular.module("ngSequoia",["angular-lodash"])}(),function(){"use strict";function e(){return{restrict:"AE",replace:!0,templateUrl:"sequoia-search.html",scope:{tree:"=",isSearching:"=",buttons:"="},link:function(e){e.search=function(){e.query.length?(e.isSearching=e.query?!0:!1,e.tree.setNodesInPath(e.tree.nodes),e.tree.setCurrentNodes(e.tree.find(e.tree.template.title,e.query))):e.clear()},e.clear=function(){e.query="",e.isSearching=!1,e.tree.setCurrentNodes(e.tree.getNodesInPath())}}}}angular.module("ngSequoia").directive("sequoiaSearch",e)}(),function(){"use strict";var e={edit:"Edit",select:"Select",deselect:"Deselect",goToSubitems:"Go to subitems",addSubitems:"Add subitems",addNode:"Add node",remove:"Delete",done:"Done",searchClear:"&times;",showSelected:"Show selected",hideSelected:"Hide selected",backToList:"Back to list"},t={id:"_id",nodes:"nodes",title:"title"};angular.module("ngSequoia").constant("BUTTONS",e).constant("NODE_TEMPLATE",t)}(),function(){"use strict";function e(e,t){return{restrict:"AE",replace:!0,templateUrl:"angular-sequoia.html",scope:{treeNodes:"=sequoiaTree",model:"=ngModel",template:"=nodeTemplate",options:"="},link:function(n){function o(){n.options=n.options?n.options:{canEdit:!1,buttons:{}},n.canEdit=n.options.canEdit?!0:!1,n.allowSelect=n.model?!0:!1,n.model=_.isArray(n.model)?n.model:[],n.breadcrumbs=[],n.tree=new e(n.treeNodes,n.template),n.buttons={edit:n.options.buttons.edit?n.options.buttons.edit:t.edit,select:n.options.buttons.select?n.options.buttons.select:t.select,deselect:n.options.buttons.deselect?n.options.buttons.deselect:t.deselect,goToSubitems:n.options.buttons.goToSubitems?n.options.buttons.goToSubitems:t.goToSubitems,addSubitems:n.options.buttons.addSubitems?n.options.buttons.addSubitems:t.addSubitems,addNode:n.options.buttons.addNode?n.options.buttons.addNode:t.addNode,remove:n.options.buttons.remove?n.options.buttons.remove:t.remove,done:n.options.buttons.done?n.options.buttons.done:t.done,searchClear:n.options.buttons.searchClear?n.options.buttons.searchClear:t.searchClear,showSelected:n.options.buttons.showSelected?n.options.buttons.showSelected:t.showSelected,hideSelected:n.options.buttons.hideSelected?n.options.buttons.hideSelected:t.hideSelected,backToList:n.options.buttons.backToList?n.options.buttons.backToList:t.backToList}}n.load=function(e){n.onlySelected=!1,n.tree.isValidNode(e)?(n.tree.setCurrentNodes(e[n.tree.template.nodes]),n.breadcrumbs=n.tree.breadcrumbs(e[n.tree.template.id])):(n.tree.setCurrentNodes(),n.breadcrumbs=[])},n.select=function(e){e[n.tree.template.id]&&n.model.push(e[n.tree.template.id])},n.deselect=function(e){var t=e[n.tree.template.id]?_.indexOf(n.model,e[n.tree.template.id]):-1;-1!==t&&n.model.splice(t,1)},n.isSelected=function(e){return-1!==_.indexOf(n.model,e[n.tree.template.id])?!0:!1},n.toggleSelected=function(){if(n.onlySelected)n.onlySelected=!1,n.tree.setCurrentNodes(n.tree.getNodesInPath());else{n.onlySelected=!0;var e=n.tree.findSelected(n.model);n.tree.setNodesInPath(n.tree.nodes),n.tree.setCurrentNodes(e)}},o(),n.load(),n.toggleEditing=function(){n.isEditing=!n.isEditing,n.allowSelect=!n.allowSelect},n.addNode=function(e){n.tree.isValidNode(e)&&n.load(e),n.options.addNode.call(n,n.tree.nodes),n.allowSelect=!1},n.remove=function(e){var t=e?_.indexOf(n.tree.nodes,e):-1;-1!==t&&n.tree.nodes.splice(t,1)}}}}e.$inject=["SequoiaTree","BUTTONS"],angular.module("ngSequoia").directive("sequoiaTree",e)}(),function(){"use strict";function e(e,t){var n,o,a,s,i,d,l,r=function(e,o){this.template=o||t,this.tree=n(_.isArray(e)?e[0]:{},this.template)?e:[]};return n=function(t,n){if(!t)return!1;for(var o=_.values(n),a=0;a<o.length;a++)if(!_.has(t,o[a]))return e.warn("The node structure is not valid!"),!1;return!0},o=function(e,t,n,a){return _.isArray(e)?_.some(e,function(e){return e[t]===n?!0:o(e[a.nodes],t,n,a)}):!1},a=function(e,t,n,o,s){if(_.isArray(e))for(var i=0;i<e.length;i++)e[i][t].toLowerCase().indexOf(n.toLowerCase())>-1&&o.push(e[i]),a(e[i][s.nodes],t,n,o,s);return o},s=function(e,t,n,a){t=t||[];var i={};i[a.title]="Root",n=n.length?n:[i];for(var d=0;d<t.length;d++)(t[d][a.id]===e||o(t[d][a.nodes],a.id,e,a))&&n.push(t[d]),s(e,t[d][a.nodes],n,a);return n},i=function(e,t,n,a){t=t||[];for(var s=0;s<t.length;s++)(t[s][a.id]===e[a.id]||o(t[s][a.nodes],a.id,e[a.id],a))&&(n+=n.length?" > ":"",n+=_.trunc(t[s][a.title],20)),n=i(e,t[s][a.nodes],n,a);return n},d=function(e,t,n,o){if(_.isArray(t))for(var a=0;a<t.length;a++)t[a]._id===e&&n.push(t[a]),d(e,t[a][o.nodes],n,o);return n},l=function(e,t,n){var o={};return o[n.id]=e[n.id],o[n.title]=i(e,t,"",n),_.isArray(e[n.nodes])&&e[n.nodes].length>0&&(o[n.nodes]=e[n.nodes]),o},r.prototype.setCurrentNodes=function(e){this.nodes=_.isArray(e)?e:this.tree},r.prototype.setNodesInPath=function(e){this.nodesInPath=_.isArray(e)?e:this.tree},r.prototype.getNodesInPath=function(){return _.isArray(this.nodesInPath)?this.nodesInPath:this.tree},r.prototype.isValidNode=function(e){return _.isObject(e)&&e[this.template.nodes]},r.prototype.breadcrumbs=function(e){return s(e,this.tree,[],this.template)},r.prototype.find=function(e,t){for(var n=[],o=a(this.tree,e,t,[],this.template),s=0;s<o.length;s++)n.push(l(o[s],this.tree,this.template));return n},r.prototype.findSelected=function(t){var n=[],o=[];if(_.isArray(t)){for(var a=0;a<t.length;a++)n=_.union(n,d(t[a],this.tree,[],this.template));for(var s=0;s<n.length;s++)o.push(l(n[s],this.tree,this.template))}else e.warn("You must pass an array of IDs in order to find the selected nodes!");return o},r}e.$inject=["$log","NODE_TEMPLATE"],angular.module("ngSequoia").factory("SequoiaTree",e)}(),angular.module("ngSequoia").run(["$templateCache",function(e){e.put("angular-sequoia.html",'<div class="sequoia">\n\n  <div class="sequoia-search">\n    <div class="sequoia-search-form" data-sequoia-search data-is-searching="searchEnabled" data-tree="tree" data-buttons="buttons"></div>\n    <div class="sequoia-actions" data-ng-include="\'sequoia-tree-actions.html\'"></div>\n  </div>\n\n  <ul data-ng-if="!searchEnabled && !onlySelected" class="sequoia-breadcrumbs" data-ng-include="\'sequoia-breadcrumbs.html\'"></ul>\n\n  <ul class="sequoia-tree">\n    <li data-ng-repeat="node in tree.nodes track by node[tree.template.id]">\n\n      <span class="sequoia-item-title">\n        <span data-ng-if="!isEditing" data-ng-bind="node[tree.template.title]"></span>\n        <span data-ng-if="isEditing">\n          <input type="text" data-ng-model="node[tree.template.title]">\n        </span>\n      </span>\n\n      <span class="sequoia-item-actions" data-ng-include="\'sequoia-item-actions.html\'"></span>\n    </li>\n  </ul>\n</div>\n'),e.put("sequoia-breadcrumbs.html",'<li data-ng-if="breadcrumbs.length" data-ng-repeat="link in breadcrumbs" data-ng-class="$last ? \'last\' : \'\'" data-ng-init="title = link[tree.template.title].length > 23 ? (link[tree.template.title] | limitTo:20) + \'&hellip;\' : link[tree.template.title]">\n  <a data-ng-if="!$last" href="" data-ng-click="load(link)" data-ng-bind="title"></a>\n  <span data-ng-if="$last" data-ng-bind="title"></span>\n</li>'),e.put("sequoia-item-actions.html",'<span data-ng-if="isSelected(node) && allowSelect">\n  <a class="sequoia-button sequoia-button-danger" href="" title="Deselect" data-ng-click="deselect(node)" data-ng-bind="buttons.deselect"></a>\n</span>\n\n<span data-ng-if="!isSelected(node) && allowSelect">\n  <a class="sequoia-button sequoia-button-primary" href="" title="Select" data-ng-click="select(node)" data-ng-bind-html="buttons.select"></a>\n</span>\n\n<span data-ng-if="isEditing">\n  <a class="sequoia-button sequoia-button-danger" href="" title="Deselet" data-ng-click="remove(node)" data-ng-bind="buttons.remove"></a>\n</span>\n\n<span data-ng-if="node[tree.template.nodes] && node[tree.template.nodes].length">\n  <a class="sequoia-button sequoia-button-info" href="" title="Go to subitems" data-ng-click="load(node)" data-ng-bind="buttons.goToSubitems"></a>\n</span>\n\n<span data-ng-if="isEditing && (!node[tree.template.nodes] || !node[tree.template.nodes].length)">\n  <a class="sequoia-button sequoia-button-info" href="" title="Add subitems" data-ng-click="addNode(node)" data-ng-bind="buttons.addSubitems"></a>\n</span>'),e.put("sequoia-search.html",'<form data-ng-submit="search()">\n  <input type="text" placeholder="Search for an item by {{tree.template.title}}" data-ng-model="query" name="search" />\n  <a class="sequoia-button sequoia-button-default" href="" data-ng-if="isSearching" data-ng-click="clear()" data-ng-bind-html="buttons.searchClear"></a>\n</form>\n'),e.put("sequoia-tree-actions.html",'<ul>\n  <li data-ng-if="(model.length || onlySelected) && !isEditing">\n    <a class="sequoia-button sequoia-button-info" href="" data-ng-click="toggleSelected()" data-ng-bind-html="model.length && !onlySelected ? buttons.showSelected : !model.length && onlySelected ? buttons.backToList : buttons.hideSelected"></a>\n  </li>\n\n  <li data-ng-if="isEditing || !tree.tree.length">\n    <a class="sequoia-button sequoia-button-success" href="" data-ng-click="addNode()" data-ng-bind-html="buttons.addNode"></a>\n  </li>\n\n  <li data-ng-if="canEdit && tree.tree.length">\n    <a class="sequoia-button sequoia-button-info" href="" data-ng-click="toggleEditing()" data-ng-bind-html="isEditing ? buttons.done : buttons.edit"></a>\n  </li>\n\n</ul>\n')}]);