!function(){"use strict";angular.module("ngSequoia",["angular-lodash"])}(),function(){"use strict";function e(){return{restrict:"AE",replace:!0,templateUrl:"sequoia-search.html",scope:{tree:"=",isSearching:"="},link:function(e,t,n){e.search=function(){e.query.length?(e.isSearching=e.query?!0:!1,e.tree.setCurrentNodes(e.tree.find(e.tree.template.title,e.query))):e.clear()},e.clear=function(){e.query="",e.isSearching=!1,e.tree.setCurrentNodes()}}}}angular.module("ngSequoia").directive("sequoiaSearch",e)}(),function(){"use strict";function e(e){return{restrict:"AE",replace:!0,templateUrl:"angular-sequoia.html",scope:{treeNodes:"=sequoiaTree",model:"=",template:"=nodeTemplate"},link:function(t,n,a){t.model=_.isArray(t.model)?t.model:[],t.breadcrumbs=[];var i=new e(t.treeNodes,t.template);t.load=function(e){i.isValidNode(e)?(i.setCurrentNodes(e[i.template.nodes]),t.breadcrumbs=i.breadcrumbs(e[i.template.id])):(i.setCurrentNodes(),t.breadcrumbs=[])},t.select=function(e){e._id&&t.model.push(e[i.template.id])},t.remove=function(e){var n=e._id?_.indexOf(t.model,e[i.template.id]):-1;-1!==n&&t.model.splice(n,1)},t.isSelected=function(e){return-1!==_.indexOf(t.model,e[i.template.id])?!0:!1},t.toggleSelected=function(){if(t.onlySelected)t.onlySelected=!1,i.setCurrentNodes();else{t.onlySelected=!0;var e=i.findSelected(t.model);i.setCurrentNodes(e)}},t.tree=i,t.load()}}}e.$inject=["SequoiaTree"],angular.module("ngSequoia").directive("sequoiaTree",e)}(),function(){"use strict";function e(e){var t,n,a,i,r,s,o,l=function(e,n){var a={id:"_id",nodes:"nodes",title:"title"};this.template=n||a,this.tree=t(_.isArray(e)?e[0]:[],this.template)?e:[]};return t=function(t,n){for(var a=_.values(n),i=0;i<a.length;i++)if(!_.has(t,a[i]))return e.warn("The node structure is not valid!"),!1;return!0},n=function(e,t,a,i){return _.isArray(e)?_.some(e,function(e){return e[t]===a?!0:n(e[i.nodes],t,a,i)}):!1},a=function(e,t,n,i,r){if(_.isArray(e))for(var s=0;s<e.length;s++)e[s][t].toLowerCase().indexOf(n.toLowerCase())>-1&&i.push(e[s]),a(e[s][r.nodes],t,n,i,r);return i},i=function(e,t,a,r){t=t||[];var s={};s[r.title]="Root",a=a.length?a:[s];for(var o=0;o<t.length;o++)(t[o][r.id]===e||n(t[o][r.nodes],r.id,e,r))&&a.push(t[o]),i(e,t[o][r.nodes],a,r);return a},r=function(e,t,a,i){t=t||[];for(var s=0;s<t.length;s++)(t[s][i.id]===e[i.id]||n(t[s][i.nodes],i.id,e[i.id],i))&&(a+=a.length?" > ":"",a+=_.trunc(t[s][i.title],20)),a=r(e,t[s][i.nodes],a,i);return a},s=function(e,t,n,a){if(_.isArray(t))for(var i=0;i<t.length;i++)t[i]._id===e&&n.push(t[i]),s(e,t[i][a.nodes],n,a);return n},o=function(e,t,n){var a={};return a[n.id]=e[n.id],a[n.title]=r(e,t,"",n),a},l.prototype.setCurrentNodes=function(e){this.nodes=_.isArray(e)?e:this.tree},l.prototype.isValidNode=function(e){return _.isObject(e)&&e[this.template.nodes]},l.prototype.breadcrumbs=function(e){return i(e,this.tree,[],this.template)},l.prototype.find=function(e,t){for(var n=[],i=a(this.tree,e,t,[],this.template),r=0;r<i.length;r++)n.push(o(i[r],this.tree,this.template));return n},l.prototype.findSelected=function(t){var n=[],a=[];if(_.isArray(t)){for(var i=0;i<t.length;i++)n=_.union(n,s(t[i],this.tree,[],this.template));for(var i=0;i<n.length;i++)a.push(o(n[i],this.tree,this.template))}else e.warn("You must pass an array of IDs in order to find the selected nodes!");return a},l}e.$inject=["$log"],angular.module("ngSequoia").factory("SequoiaTree",e)}(),angular.module("ngSequoia").run(["$templateCache",function(e){e.put("angular-sequoia.html",'<div class="sequoia" data-ng-show="tree.tree.length">\n\n  <div class="sequoia-search">\n    <div class="sequoia-search-form" data-sequoia-search data-is-searching="searchEnabled" data-tree="tree"></div>\n    <div class="sequoia-actions" data-ng-if="model.length">\n      <ul>\n        <li><a class="sequoia-button sequoia-button-info" href="" data-ng-click="toggleSelected()">{{onlySelected ? \'Hide selected\' : \'Show selected\'}}</a></li>\n      </ul>\n    </div>\n  </div>\n\n  <ul data-ng-if="!searchEnabled && !onlySelected" class="sequoia-breadcrumbs" data-ng-include="\'sequoia-breadcrumbs.html\'"></ul>\n\n  <ul class="sequoia-tree">\n    <li data-ng-repeat="node in tree.nodes track by node[tree.template.id]">\n      <span class="sequoia-item-title" data-ng-bind="node[tree.template.title]"></span>\n      <span class="sequoia-item-actions">\n        <span data-ng-if="isSelected(node)">\n          <a class="sequoia-button sequoia-button-danger" href="" title="Remove" data-ng-click="remove(node)">Remove</a>\n        </span>\n        <span data-ng-if="!isSelected(node)">\n          <a class="sequoia-button sequoia-button-primary" href="" title="Select" data-ng-click="select(node)">Select</a>\n        </span>\n        <span data-ng-if="node[tree.template.nodes]">\n          <a class="sequoia-button sequoia-button-info" href="" title="Go to subitems" data-ng-click="load(node)">Go to subitems</a>\n        </span>\n      </span>\n    </li>\n  </ul>\n</div>\n'),e.put("sequoia-breadcrumbs.html",'<li data-ng-if="breadcrumbs.length" data-ng-repeat="link in breadcrumbs" data-ng-class="$last ? \'last\' : \'\'" data-ng-init="title = link[tree.template.title].length > 23 ? (link[tree.template.title] | limitTo:20) + \'&hellip;\' : link[tree.template.title]">\n  <a data-ng-if="!$last" href="" data-ng-click="load(link)" data-ng-bind="title"></a>\n  <span data-ng-if="$last" data-ng-bind="title"></span>\n</li>'),e.put("sequoia-search.html",'<form data-ng-submit="search()">\n  <input type="text" placeholder="Search for an item by {{tree.template.title}}" data-ng-model="query" name="search" />\n  <a class="sequoia-button sequoia-button-default" href="" data-ng-if="isSearching" data-ng-click="clear()">&times;</a>\n</form>\n')}]);